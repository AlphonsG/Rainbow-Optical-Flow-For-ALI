# Rainbow

![](misc/images/banner_img.png?raw=true "Rainbow")

Repository for software detailed in 'RAINBOW: Automated Air-Liquid Interface Cell Culture Analysis Using Deep Optical Flow' Application Note. See Abstract [below](#application-note-abstract) for more details.

## Preliminary Information

Rainbow can be installed on popular operating systems such as Linux and Windows. We recommend using a GPU-enabled system for fast runtimes. Rainbow can also concurrently perform data analysis report generation for multiple image series.

## Installation

We recommend installing and running Rainbow within a virtual environment.

Tested on Windows 10 using Python 3.7 and miniconda3.

### Pre-requisites

1. Download and install [miniconda3](https://docs.conda.io/en/latest/miniconda.html), [Git](https://git-scm.com/downloads), and [Microsoft Visual C++ 2008 Service Pack 1 Redistributable Package](https://www.microsoft.com/en-US/download/details.aspx?id=26368)  for your system.

### Installing Rainbow

1. Launch 'Anaconda Prompt (miniconda3)'. The proceeding commands will be entered into this window.

2. Create a virtual environment with Python 3.7 and pywin32 preinstalled called 'rainbow_env':

    ```conda create -n rainbow_env python=3.7 pywin32```

3. Activate the environment:

   ```conda activate rainbow_env```


4. Clone this repository into your desired directory:

   ```git clone https://github.com/AlphonsGwatimba/Automated-Air-Liquid-Interface-Cell-Culture-Analysis-Using-Deep-Optical-Flow.git```

5. Navigate into the cloned directory:

    ```cd Automated-Air-Liquid-Interface-Cell-Culture-Analysis-Using-Deep-Optical-Flow.git```
6. Install Rainbow:

   ```python setup.py install```

- Note:  Virtual environment can be deactivated using:

   ```conda deactivate rainbow_env```

## Usage

Rainbow is a command line application. Enter `rainbow --help` within the `rainbow_env` environment for details on how to run Rainbow.
## Additional Information

### Configuration File

Rainbow requires a configuration file to run. A base config file that can be modified is provided [here](misc/configs/default_config.yaml).

### Optical Flow

Rainbow uses a deep learning model called [PWC-Net](https://arxiv.org/abs/1709.02371) to compute the optical flow in an image series. This model can be easily replaced with any other method for computing optical flow by writing a custom class that implements the [base_model](rainbow/optical_flow/base_model.py) interface ([pwc_net](rainbow/optical_flow/pwc_net.py) is an example of that).

### Analysis

Rainbow can automatically generate an analysis report after computing the optical flow in an image series. A base report file that can be modified is provided [here](misc/notebooks/report.ipynb) as a Jupyter notebook. The path of a Jupyter notebook needs to specified in the config for automatic report generation.

## Examples

An example ALI cell culture image series is provided [here](examples/image_series_1). The optical flow computation and analysis report output files generated by Rainbow are also provided. Examples of some of the generated images can be seen below.

### Raw Image Series (left) and Rainbow Optical Flow Visualisation (Right)

<img src="misc/images/raw_vs_flow.gif" width="780"/>

### Magnitude Heatmaps Across Image Series (Left) and Quiver Plots Across Image Series (Right)

<p float="left">
  <img src="misc/images/heatmap.gif" width="390" />
  <img src="misc/images/quiver_plot.gif" width="390" />
</p>

## License

[MIT License](LICENSE)

## Acknowledgements

- https://github.com/philferriere/tfoptflow
- https://docs.opencv.org/3.4/d4/dee/tutorial_optical_flow.html

## Application Note <a name="application-note-abstract"></a>

### Title
RAINBOW: Automated Air-Liquid Interface Cell Culture Analysis Using Deep Optical Flow

### Abstract
To be released

### Access
To be released

## Our Team
[Learn more](https://walyanrespiratory.telethonkids.org.au/our-research/focus-areas/artifical-intelligence/)
